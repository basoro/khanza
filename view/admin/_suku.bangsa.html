<div class="easyui-layout" border="false" fit="true" style="padding:0;margin:0;">
    <div data-options="region:'north'" border="false" style="padding:10px 0;margin:10px 0;">
        <table id="dlgPenggunaForm">
            <tr>
                <td>Suku/Bangsa Pasien</td>
                <td><input name="nama_suku_bangsa" id="nama_suku_bangsa" class="easyui-textbox" style="width:300px;"></input></td>
            </tr>
        </table>
    </div>
    <div data-options="region:'center'" border="thin">
        <table id="dg_suku_bangsa" class="easyui-datagrid" footer="#toolbar_suku_bangsa">
        </table>
    </div>
</div>

<div id="toolbar_suku_bangsa" style="padding:8px 0;">
    <div style="float: left; color: #000;padding: 0 40px 0 10px;">
        <label>Keyword</label>
        <input class="easyui-textbox" id="cari_keyword" style="width:150px;">
        <a href="#" class="easyui-linkbutton" style="color: #000;" iconCls="icon-ok" onclick="doSearchSukuBangsa()"></a>
    </div>
    <div style="float: left;">
        <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-add',plain:true" style="margin:0 5px;" onclick="newSukuBangsa()">Baru</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-save',plain:true" style="margin:0 5px;" onclick="saveSukuBangsa()">Simpan</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-edit',plain:true" style="margin:0 5px;" onclick="editSukuBangsa()">Ubah</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-cut',plain:true" style="margin:0 5px;" onclick="deleteSukuBangsa()">Hapus</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-cancel',plain:true" onclick="removeTab_suku_bangsa()" style="margin:0 15px;">Keluar</a>
    </div>
</div>

<script type="text/javascript">
    var url;
    $('#dg_suku_bangsa').datagrid({
      url:'{?=url()?}/{?=ADMIN?}/khanza/sukubangsa/?act=data&t={?=$_SESSION['token']?}',
      rownumbers:true,
      singleSelect:true,
      pageSize:20,
      pagination:true,
      remoteFilter:false,
      remoteSort:false,
      multiSort:false,
      fitColumns:false,
      fit:true,
      columns:[[
        { field:'ck',checkbox:true},
        { field:'id',title:'ID',width:100,sortable:true},
        { field:'nama_suku_bangsa',title:'Nama Suku Bangsa',width:300,sortable:true}
      ]],
      onClickRow: function(){
        var row = $('#dg_suku_bangsa').datagrid('getSelected');
        $('#suku_bangsa').textbox('setValue',row.nama_suku_bangsa);
        $('#nama_suku_bangsa').textbox('setValue',row.nama_suku_bangsa);
        $('#dlgSukuBangsa').dialog('close');
	  },
    });

    function doSearchSukuBangsa(){
        $('#dg_suku_bangsa').datagrid('load',{
            cari_keyword: $('#cari_keyword').val()
        });
    }

    function removeTab_suku_bangsa(){
        $('#wu-tabs').tabs('close','Suku Bangsa');
        $('#dlgSukuBangsa').dialog('close')
    }

    function newSukuBangsa(){
        alert('Add suku bangsa');
        $('#nama_suku_bangsa').textbox('setValue','');
    }

    function saveSukuBangsa(){
      var nama_suku_bangsa = $('#nama_suku_bangsa').val();
      var url = '{?=url([ADMIN,'suku_bangsa','save'])?}';
      $.ajax({
        type: 'POST',
        url: url,
        data: {nama_suku_bangsa:nama_suku_bangsa},
        success: function(result){
          var result = eval('('+result+')');
          if (result.msg){
              $.messager.show({
                  title: 'Informasi pesan',
                  msg: result.msg
              });
              $('#dg_suku_bangsa').datagrid('reload');
              $('#nama_suku_bangsa').textbox('setValue','');
          } else {
            $.messager.show({
                title: 'Informasi error',
                msg: result.msg
            });
          }
        }
      });
    }

    function editSukuBangsa(){
      var row = $('#dg_suku_bangsa').datagrid('getSelected');
      var rows = $('#dg_suku_bangsa').datagrid('getSelections');
      var id = row.id;
      var nama_suku_bangsa = $('#nama_suku_bangsa').val();
      var url = '{?=url([ADMIN,'suku_bangsa','edit'])?}';

      if(rows.length === 0){
          $.messager.alert('Notifikasi','Silahkan pilih data!','info');
          return;
      }else if(rows.length > 1){
          $.messager.alert('Notifikasi','Pilih salah satu data saja boss!','info');
          return;
      }

      if(row) {
        $.ajax({
          type: 'POST',
          url: url,
          data: {id:id,nama_suku_bangsa:nama_suku_bangsa},
          success: function(result){
            var result = eval('('+result+')');
            if (result.msg){
                $.messager.show({
                    title: 'Informasi pesan',
                    msg: result.msg
                });
                $('#dg_suku_bangsa').datagrid('reload');
                $('#nama_suku_bangsa').textbox('setValue','');
            } else {
              $.messager.show({
                  title: 'Informasi error',
                  msg: result.msg
              });
            };
          }
        });
      }
    }

    function deleteSukuBangsa(){
      var row = $('#dg_suku_bangsa').datagrid('getSelected');
      var rows = $('#dg_suku_bangsa').datagrid('getSelections');
      if(rows.length === 0){
          $.messager.alert('Notifikasi','Silahkan pilih data!','info');
          return;
      }else if(rows.length > 1){
          $.messager.alert('Notifikasi','Pilih salah satu data saja boss!','info');
          return;
      }
      if (row){
          $.messager.confirm('Confirm','Yakin menghapus data ini?',function(r){
              if (r){
                  $.post('{?=url()?}/admin/suku_bangsa/delete?t='+mlite.token,{id:row.id},function(result){
                      if (result.success){
                          $('#dg_suku_bangsa').datagrid('reload');
                      } else {
                          $.messager.show({ 
                              title: 'Error',
                              msg: result.errorMsg
                          });
                      }
                  },'json');
              }
          });
      }
    }

</script>
